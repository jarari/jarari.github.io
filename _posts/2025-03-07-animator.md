---
title: >
    Unity Animator
tags: [Unity]
style: border
color: primary
description: >
    애니메이터의 이모저모
---

![Animator](assets/animator.png)

애니메이터는 간단히 표현하면 유니티 게임에서 애니메이션 클립을 재생해주는 컴포넌트 입니다. 유한 상태 기계 (Finite-State Machine) 모델을 취하고 있으며, 여기에 추가적으로 레이어를 구성하여 여러 개의 유한 상태 기계가 동시에 동작하게 할 수 있습니다.<br>
Entry에서 시작한 애니메이터는 바로 첫번째 스테이트로 이동하게 됩니다. 이후 파라미터에 정의된 여러 변수와 이 변수들을 사용하는 트랜지션을 통해 스테이트들을 오갈 수 있으며, 이 때 3D 오브젝트를 애니메이팅 할 때에는 스테이트를 오가는 시점과 조건, 블렌딩 되는 정도 등등 여러 옵션을 자연스럽게 지정해주어야 좀 더 좋은 결과물을 얻을 수 있습니다.

### 레이어

![레이어](assets/animator2.png)

레이어는 애니메이터가 여러 상태를 동시에 가지게 해줍니다. 이렇게 되면 여러가지 애니메이션 클립이 동시에 재생되게 되는데, 이 클립들이 블렌딩 되는 정도는 각 레이어에 있는 Weight를 통해 정의해 줄 수 있으며, 블렌딩 타입또한 Override 혹은 Additive 중에 고를 수 있습니다. 모든 레이어가 오버라이드인 상태에서 웨이트가 1로 지정되면 맨 아래에 있는 레이어의 클립이 모든 변경점을 덮어쓰게 되지만, 만약 레이어들에서 재생되는 클립에 겹치는 변경점이 없다면 모든 변경점이 같이 출력되게 됩니다.<br>
하지만, 애니메이션 클립들은 대게 캐릭터의 전신에 변경점을 가하는 경우가 많기 때문에 이럴 때엔 레이어별로 아바타 마스크를 지정하여 해당 레이어의 클립이 아바타의 어느 지점들에 적용될 것인지 지정할 수 있습니다. 또한, 어디티브 레이어를 이용하면 해당 클립의 0프레임 혹은 별도로 지정된 레퍼런스 포즈를 기준으로 발생하는 변경점을 애니메이터가 추가적으로 얹어주게 되는데 이런 구성도 유용하게 사용될 수 있습니다.

![마스크](assets/animator3.png)

저는 TPS 캐릭터를 구성할 때 전신에 클립을 재생하는 UpperBody 레이어, 상반신에 추가적인 어디티브 애니메이션을 재생할 UpperBodyAdditive 레이어, 로코모션을 담당할 LowerBody 레이어를 만든 후 LowerBody 레이어에는 휴머노이드 아바타 기준 하반신과 하반신 IK에 해당되는 마스크를 씌워 걸어다니면서 격발, 재장전, 수류탄 투척이 가능한 캐릭터를 구현하였습니다. 만약 필요한 경우, UpperBodyAdditive 레이어에 수직 손잡이 어디티브 클립을 추가하여 수직 손잡이 장착/미장착 애니메이션도 구현할 수 있습니다.<br>
다만 이러한 구성을 사용할 때에는 레이어들이 개별적인 트랜지션과 스테이트를 통해 동작한다는 점을 잘 이해하고 계획적으로 설계하여야 의도하지 않은 블렌딩 오류나 조작상의 문제를 방지할 수 있습니다.

### 블렌드 트리

![8방향 로코모션](assets/animator4.png)

블렌드 트리를 사용하면 하나의 스테이트에서 파라미터에 따라 여러가지 모션을 블렌딩하여 출력해줄 수 있습니다.<br>
제 TPS 캐릭터는 360도 회전하며 정면으로 달릴 수도 있지만, 조준하며 움직일 때 8방향 로코모션도 지원해줘야 했으므로 블렌드 트리를 활용하여 이를 구현하였습니다. 플레이어의 입력이 들어왔을 때, 캐릭터를 서서히 카메라 기준 앞, 뒤, 좌, 우로 가속하고 해당 가속도 벡터를 기준으로 Horizontal, Vertical 파라미터를 정해준 뒤 Speed 파라미터로 캐릭터가 8가지 방향으로 걷는 속도를 자연스럽게 조절해주었습니다.

![1D 파라미터](assets/animator5.png)

8방향 로코모션이 없는 캐릭터들의 경우에는 1D 블렌드로 스피드 파라미터만 사용하여 속도에 맞게 애니메이션을 재생해주었습니다.