---
name: 테무에서 산 젠레스 존 제로
tools: [C#]
image: assets/temuzzz.png
description: 유니티 C#을 이용한 3D 액션 게임. Zenless Zone Zero 모작
---

# 테무에서 산 젠레스 존 제로
![타이틀](assets/temuzzz2.png)
Unity 2021.3.20f1 버전으로 제작한 젠레스 존 제로 모작 3D 액션 게임입니다.<br>
## 구현 핵심 영상
{% include elements/video.html id="T9ESzTrSrxs" %}
## 풀게임 코멘터리 영상
{% include elements/video.html id="YxHNFis9i4o" %}


<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/ActionPortfolio" text="프로젝트 GitHub" %}
</p>

## 핵심 구현 요소
<br>
젠레스 존 제로 모작인 만큼 속성 이상을 제외한 모든 전투 시스템을 구현하는 것이 목표였습니다.<br>
따라서 크게 UI, 플레이어블 3명 교대, 일반 공격 콤보, 스킬, 연출을 포함한 궁극기, 닷지, 카운터, 연계기를 구현하는 것을 목표로 잡았습니다.<br>

### 1. 플레이어 교대

![플레이어 교대](assets/temuzzz4.png)

닌자, 팔라딘, SWAT 3명의 플레이어블 캐릭터를 원하는 타이밍에 교체할 수 있습니다.<br>
젠레스 존 제로와 비슷하게 공격 입력 후 캐릭터를 교대하면 필드에 남아 나머지 모션을 모두 수행한 후 퇴장하게 하였기 때문에 퀵 스위칭 전략도 사용할 수 있습니다.<br>
<br>

### 2. 일반 공격 콤보

![닌자 일반 공격 코드](assets/temuzzz3.png)

애니메이터 컨트롤러와 애니메이션에 추가한 여러 이벤트를 이용하여 공격 타이밍에 맞춰 피격 판정과 사운드를 재생하고 콤보가 부드럽게 연계되면서도 타게팅한 적을 편하게 맞출 수 있도록 구현하였습니다.<br>
일반적인 공격을 시작하면 근접 캐릭터는 캐릭터 근처로 빠르게 이동되며, 모션이 조금 긴 공격의 경우 AttackFollow 태그를 지정하여 위치와 바라보는 각도가 적을 유도하도록 하였습니다.<br>
<br>

### 3. 스킬 공격

![스킬 공격 코드](assets/temuzzz5.png)
스킬 공격은 캐릭터에 스킬 함수와 이벤트를 노출시키고, 캐릭터별 행동 제어 스크립트를 별개로 작성하여 해당 이벤트에 구독하는 형식으로 구현하였습니다.<br>
상속 후 오버라이드 하는 방법도 있으나, 캐릭터별로 행동 특성이 크게 달라지는 경우가 많아 스크립트를 분리하는 방식을 택하였습니다.<br>
<br>

### 4. 궁극기

![타임라인 연출](assets/temuzzz6.png)
사진에선 데모를 위해 타임라인에 애니메이션을 포함한 상태이지만, 실시간 액션 게임이라는 특성 상 애니메이션은 애니메이터에서 재생하게 하고 기타 이펙트는 타임라인으로 제어하는 방식으로 구현하였습니다.<br>
카메라 연출은 별개 레이어에 있는 카메라와 Cinemachine을 애니메이팅하여 표현하였고, Culling Mask를 적절히 설정하여 궁극기 연출만 렌더링 되는 상태로 만든 후 캐릭터 메쉬 레이어를 잠시 궁극기 연출 레이어로 옮겨주는 방식으로 궁극기를 사용중인 캐릭터만 화면에 렌더링되도록 하였습니다.

![스탯 변화](assets/temuzzz6_1.png)
팔라딘의 경우 단순 공격기보다는 자체적인 버프 효과를 주면 좋을 것 같아 캐릭터에 StatModifier 클래스를 이용하여 버프 리스트를 구현하고 매 프레임 업데이트 시켜주는 방식으로 30초간 공격력 버프를 받을 수 있게 하였습니다.<br>
또한, 여러 헬퍼 함수들을 통해 해당 버프가 작동중인지 확인하고 등장/퇴장 혹은 궁극기 시전 시 적절하게 칼에 불이 붙어있는 이펙트와 사운드 효과가 재생되도록 구현하였습니다.<br>

### 5. 닷지와 카운터

![공격 매니저](assets/temuzzz8.png)

닷지와 카운터는 먼저 적이 공격한다는 정보를 알고 있어야 가능하기 때문에, 적들의 공격을 관리하는 매니저를 만들어놓고 근처에 등록된 공격이 있는 경우 입력에 맞게 닷지 혹은 카운터가 발동되도록 하였습니다.<br>
적들이 공격하려하는 순간 먼저 노란빛 (카운터 가능) 혹은 빨간빛 (카운터 불가) 이펙트가 표시되며, 공격 매니저에 공격이 등록됩니다. 이후 공격이 발동 (ProcAttack) 되기 전까지 닷지 혹은 카운터 입력이 들어오게 되면, 공격과 플레이어의 거리를 판단하여 닷지 혹은 카운터가 수행됩니다.<br>

![URP Renderer Feature](assets/temuzzz7.png)
![Desaturation](assets/temuzzz7_1.png)
닷지의 경우에는 회피하였다는 느낌을 주기 위해 URP의 Renderer Feature을 이용하여 플레이어와의 거리 기반으로 desaturate 하는 커스텀 쉐이더를 제작하였습니다. Render Objects 기능을 이용하여 캐릭터와 월드에 표기되는 UI에 스텐실 값을 부여하고, 쉐이더는 해당 스텐실 값이 아닌 픽셀을 대상으로 작동하도록 구성하여 월드가 회색으로 전환되었다가 플레이어를 중심으로 빛을 되찾는 비주얼을 구현하였습니다. 애니메이트 커브와 로컬 볼륨을 이용하여 부드럽게 블렌딩되는 비그네트 효과도 추가해주었습니다. 또한, 타임스케일을 통한 슬로우모션 대신 StatModifier를 이용하여 디버프 형태로 애니메이터의 재생 속도를 조절하는 방식을 이용하여 적들만 잠시 느려지는 효과를 주었습니다.<br>

![카운터](assets/temuzzz9.png)
카운터는 카운터 루프 애니메이션을 먼저 재생시켜두고, 공격 판정이 들어왔을 때 카운터 상태이면 카운터 피격 애니메이션과 VFX 그래프 및 쉐이더 그래프를 이용해 제작한 효과 재생 후, 추가 입력이 들어올 경우 카운터 반격을 수행하도록 구성하였습니다. 연출을 위해 Cinemachine을 활용하여 좌측과 우측 중 카메라의 현재 각도와 가까운 카메라를 찾아 받아치는 듯한 앵글을 구성해주었습니다.<br>

### 6. 연계기

![연계기 UI](assets/temuzzz10.png)
연계기는 1. 그로기 게이지를 모두 채워 그로기에 빠진 적을 상대로 2. 연계기 발동 가능 횟수가 남아있을 때 3. 그로기 발동 가능한 공격 (스킬 혹은 일반 공격 막타)이 명중하면 발동되도록 구현하였습니다. 게임 내에서 타임스케일을 조정하는 것이 일시정지 혹은 콤보UI 단 두가지 뿐임이 확실하기 때문에, 별도의 시간 관리 클래스를 만들지 않고 바로 필요한 변경점들을 적용하도록 하였습니다.<br>
코드가 실행되면 아래와 같은 화면이 구성됩니다.

![연계기 발동](assets/temuzzz10_1.png)
연계기 또한 시간과 관계없이 업데이트되는 Cinemachine과 볼륨의 DoF 이펙트를 통해 몰입감을 주었습니다. 좌측과 우측에 나타나는 캐릭터는 캐릭터 교대 가능 순서에 따라 나타나며, 마우스 좌클릭 혹은 우클릭으로 원하는 캐릭터의 연계기를 사용할 수 있습니다. 즉, 동일한 캐릭터가 연계기를 여러 번 사용할 수도 있습니다.<br>
연계기를 발동하였을 때 캐릭터가 나타나는 위치는 마지막 행동 캐릭터로의 벡터를 Y축으로 120도 회전한 방향으로 지정하였으며, 캐릭터 타입에 따라 다른 거리에서, 레이캐스트를 이용하여 맵을 뚫고 생성되는 일이 없게 처리하여 주었습니다.<br>

### 7. 기타 활용 요소

#### 1. Animation Rigging 패키지
![트래킹](assets/temuzzz11.png)
SWAT 캐릭터는 다양한 무기를 휴대하고 이를 이용하여 공격하는 원거리 캐릭터로 기획하였으나, 제가 구할 수 있는 애니메이션 리소스들이 무기 모델과 일치하지 않아 Animation Rigging 패키지를 적극 활용하여 애니메이션을 실시간으로 변경해주었습니다. 위 사진은 해당 패키지를 통해 플레이어가 조준하고 있는 방향에 정확히 총구를 조준하는 캐릭터의 모습입니다.
![무기 변경](assets/temuzzz11_1.png)
스킬 사용 시 혹은 궁극기 발동 시에도 컨스트레인츠를 적절히 활용하여 자연스럽게 몸에 부착된 수류탄과 무기를 집어들고 사용하도록 구현하였습니다.

#### 2. Cinemachine
![입장 시퀀스](assets/temuzzz12.png)
현대 게임들의 필수 요소인 자연스러운 카메라 전환, 여러 모션과 설정된 샷을 구현하기 위해 다양한 타입의 Cinemachine 카메라를 배치하고 상황에 맞게 우선순위를 타임라인 또는 스크립트로 조절하는 방식으로 구현하였습니다. 위 사진은 젠레스 존 제로의 입장 모션을 Tracked Dolly 타입의 카메라로 구현한 모습입니다.

#### 3. New Input System
![인풋 레이아웃](assets/temuzzz13.png)
유니티에서 새롭게 제공하는 New Input System의 액션맵 기능을 이용하여 컨텍스트에 맞는 적절한 액션맵으로 전환해주고 해당 인풋만 처리할 수 있는 시스템을 구현하였습니다.