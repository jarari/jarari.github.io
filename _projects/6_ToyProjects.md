---
name: 게임 모딩 프로젝트
tools: [C++]
image: assets/uneducatedshooter.png
description: 스카이림, 폴아웃 4 모딩 모음입니다.
---

# Immersive Impact

저는 스카이림을 레전더리 에디션 시절부터 약 2천시간 플레이했는데요. 할 때 마다 아쉬운 부분이 근접 전투가 아니었나 싶습니다. 특히 애니메이션의 퀄리티, 루트 모션의 미적용, 타격감의 부재가 문제였는데요. 이걸 해결하기 위해 밤낮없이 스카이림의 어셈블리 코드를 읽으며 관련 함수들의 메모리 오프셋을 정리하고, 저에게 필요한 함수들을 찾아서 기능을 바꾸거나 추가하여 만든게 이 Immersive Impact 입니다.<br>

<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/ImmersiveImpactSE" text="프로젝트 GitHub" %}
</p>

### 애니메이션 - Telegraphing Attack

![공격 속도 보정](assets/immersiveimpact_speed.gif)

정말 미세한 차이지만, 스카이림 애니메이션의 전반적인 문제점은 모션의 커브가 굉장히 완만하다는 점입니다. 칼을 휘두를 때 강약의 차이 없이 일정한 속도로 움직이니 공격한다는 느낌이 들지 않았죠. 이를 해결하려면 아에 애니메이션을 전부 새로만드는게 최선이었는데,  저는 그 당시엔 모션 캡쳐 퀄리티만큼의 3인칭 애니메이션을 만들 자신도, 도구도 없었습니다. 그래서 생각해낸 방식이 이벤트 기반 공격 속도 보정입니다.<br>
<br>
보통 타격감이 좀 좋다는 평가를 받는 몬스터헌터나 소울류의 게임들을 보면  공격 모션의 전조 동작이 매우 크다는 것을 알 수 있습니다. 저희는 본능적으로 그 모션을 보고 "곧 공격이 온다." 라는 느낌을 받게 되며, 전조 동작의 길이가 길 수록 "더 강한 공격이 온다." 라는 느낌을 받죠. 이를 Telegraphing Attack 이라고 하는데요. 저는 캐릭터에 있는 애니메이션 이벤트 처리 가상함수를 제 함수로 덮어씌우는 방식을 이용하여 애니메이션 이벤트를 읽어오고 무기 타입, 현재 애니메이션 phase에 따라 공격 속도를 다이나믹하게 조절하는 방식으로 이를 구현하였습니다.<br>
<br>

### 타격감 - Hit Stop, Blur, Camera Shake

{% include elements/video.html id="0EzfUSYoKZE" %}

위 영상에는 제가 생각하는 타격감을 이루는 요소들이 모두 들어가 있습니다. 타격 순간 잠깐의 정지, 화면 블러, 그리고 카메라 쉐이크. 놀랍게도 스카이림 기본 게임에는 엔진에 기능이 다 있음에도 이 요소가 단 하나도 없어요. 그래서 저는 이 모든 요소를 무기 타입별로, 그리고 공격 타입에 따라 다른 강도로 적용되게 구현하였습니다. 추가로 컨트롤러 진동까지 넣어서 패드 유저들은 더 큰 타격감을 느낄 수 있도록 하였습니다.<br>
<br>

### 대쉬와 넉백

![대쉬](assets/immersiveimpact_dash.gif)
![넉백](assets/immersiveimpact_knockback.gif)

대쉬와 넉백 또한 타격감에 좋은 영향을 줍니다. 공격을 하는 순간, 그리고 공격이 맞는 순간 캐릭터가 큰 가속도를 받으면 플레이어도 무언가가 명중했다는 느낌을 받게 되죠. 하지만 스카이림의 캐릭터 컨트롤러 코드는 일반적인 게임들의 캐릭터 컨트롤러와 약간 달랐습니다. 땅 위에 있는 상태에서는 아무리 큰 가속도를 줘도 무시하도록 설정되어 있고, 공중에서는 조작을 가하면 무조건 고정된 속도로 움직이도록 설정되어 있었습니다. 그래서 저는 캐릭터 가속 시스템을 구현하여 땅 위의 캐릭터를 강제로 공중에 띄운 후 간단한 물리 연산을 통해 일정한 가속도가 적용되도록 만들었습니다.<br>
<br>

### 결과물

![결과물](assets/immersiveimpact_final.gif)
제가 구현한 결과물에 다른 애니메이터의 루트 모션 기반 공격 애니메이션까지 합치면<br>
스카이림의 전투는 이런 느낌으로 탈바꿈합니다.<br>
훨씬 재밌어보이죠?<br>

# Shield Framework

스카이림의 모딩 방향이 판타지를 추구한다면 폴아웃 4의 플레이어들은 약간 다릅니다. 그들은 매우 현실적이고, 전술적인 건 파이트 시뮬레이터를 원하죠. 그런데 이런 환경에 콜 오브 듀티 스타일의 전술 방패가 없다는건 정말 유저들의 오랜 숙원이었습니다.<br>
<br>
이를 위해 저는 크리에이션 엔진에서 사용하는 Havok 물리 엔진을 이용하여 투사체와 근접 공격을 감지 할 수 있는 플레이어에게 장착되는 충돌체를 추가하고 이에 필요한 데이터들을 구성하여 장착할 수 있는 전술 방패를 구현하였습니다. 또한, 해당 데이터들을 유저들이 직접 추가하고 커스텀 할 수 있게 기능을 확장하여 무기나 방어구 어떤 형태와 모양, 재질의 방패든 직접 추가할 수 있는 프레임워크를 제작하였습니다.<br>

<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/ShieldFramework" text="프로젝트 GitHub" %}
</p>

## 개발 난관들
<br>
### 1. Havok 충돌체의 콜리전 필터

![콜리전 필터 설정](assets/shieldframework_inithavok.png)
폴아웃 4에서는 무기가 플레이어에게 장착될 때, 충돌체가 방패 오브젝트가 아닌 경우 투사체와 충돌이 일어나지 않도록 콜리전 필터가 설정되고 있었습니다. 여기서 "방패 오브젝트" 라는 표현이 조금 문제인데, 이 방패는 사실 스카이림의 방패를 가리킵니다. 엔진 코드를 재사용하면서 방패 관련 코드가 일부 넘어온 것인데, 이는 거의 더미 데이터에 가까우며 제가 사용하려는 의도와도 일치하지 않았습니다. 그러므로 저는 프레임워크에 등록된 방패 장착 시, 해당 방패 데이터에 맞도록 충돌체를 Havok 월드에 새로 생성하고, 콜리전 필터 및 모션 타입 설정까지 적절하게 해주었습니다.<br>
<br>
### 2. 1인칭과 3인칭간 좌표 불일치

![1인칭 카메라와 3인칭 모델](assets/shieldframework_skelmismatch.png)
3인칭 시점에서는 문제가 없는데 1인칭 시점에서는 자꾸 방패를 뚫고 데미지가 들어오는 문제가 발생했습니다. 이유가 무엇인가, 연구해보았더니 폴아웃 4에선 1인칭과 3인칭용 biped가 따로 존재하는데, 히트박스는 3인칭 biped에만 존재하고, 시점을 1인칭으로 전환하면 3인칭 biped의 애니메이션 시스템이 비활성화 되면서 좌표가 불일치하였기 때문입니다. 이를 해결하기 위하여, 저는 1인칭과 3인칭 사이의 좌표 차이를 보정하고 트래킹할 bone의 리스트를 만들어서 1인칭과 3인칭 biped 간의 오차를 제거하였습니다.<br>
![1인칭 카메라와 3인칭 모델 보정](assets/shieldframework_skelmismatch2.png)
오차를 보정해준 이후에는 1인칭과 3인칭 모델이 정확히 겹쳐지는 것을 확인하실 수 있습니다.<br>
<br>
### 3. 엔진 내 하드코딩 데이터들

![임팩트 데이터](assets/shieldframework_hardcoded.png)
투사체가 오브젝트와 충돌할 때의 이펙트가 특정 조건에 의해 덮어씌워지거나, 게임 내 특정 레코드를 참조하도록 만들어진 것도 제가 해결해야 할 과제였습니다. 그 중 하나의 예로, 폴아웃 4의 NPC들은 종족을 기반으로 외형이나 특성들을 상속받는데 NPC가 투사체에 맞은 경우, 어디에 맞았든 NPC의 종족에 지정된 타격 이펙트를 사용하도록 프로그래밍 된 부분이 있었습니다. 이 부분은 하는 수 없이 jmp로 덮어씌워 조건문을 무시하도록 처리해주었습니다. 또한, 유저가 추가한 투사체-충돌체 임팩트 데이터를 런타임 때 하드코딩 된 레코드로 추가 삽입 해주도록 처리했습니다.<br>
<br>
### 4. 애니메이션

![공격 모션](assets/shieldframework_anim.gif)
![공격 모션2](assets/shieldframework_anim2.gif)
근접 무기는 1인칭, 3인칭을 모두 포함하여 약 230개의 애니메이션이 필요합니다. 방패는 폴아웃 4 내에 아에 존재하지 않던 타입이기 때문에 새로운 애니메이션을 만들어줘야 했습니다. 1인칭 애니메이션의 경우 외국 모더의 도움을 받아 모던워페어 2의 애니메이션을 포팅했고 나머지 200개의 3인칭 애니메이션은 기존 애니메이션을 참고하여 3ds Max로 새로 제작했습니다.<br>
<br>
### 결과물

{% include elements/video.html id="LrLbN7csBsQ" %}
최종적으로 게임 내에 구현된 결과물입니다.<br>
방패의 몸통과 유리부분이 투사체에 다른 임팩트 데이터를 출력하며, 근접 공격 데미지 또한 잘 상쇄하는 것을 볼 수 있습니다. 방패로 막지 않았을 때 플레이어가 바로 사망하는 모습도 확인하실 수 있습니다.<br>

# Uneducated Shooter

폴아웃 4는 2015년에 출시된 게임으로, 상당히 오래된 작품입니다. 또한, 슈터 요소보다는 롤플레잉 요소에 조금 더 치중되어 있는 게임이기도 합니다. 최근 플레이어들의 트렌드는 이와는 사뭇 다릅니다. 아에 Apex Legend, Valorant 같이 아케이드성을 강조한 게임이나 Rainbow Six: Siege나 Escape From Tarkov같이 극단적으로 현실적이고 전략적인 게임들이 유행하고 있죠. 이 트렌드에 맞춰 저는 폴아웃 4의 전략성을 강화시키는 모드를 제작하였습니다.<br>

<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/UneducatedShooter" text="프로젝트 GitHub" %}
</p>
## 주요 기능
<br>
### 1. 카메라 및 총기 관성
{% include elements/video.html id="6k_rZS9hRXA" %}
[Bodycam](https://www.youtube.com/watch?v=OJtv52GuSWM) 이라는 게임에서 영감을 받은 저는 해당 게임과 비슷한 묵직한 느낌을 주면서도 게임 플레이에는 크게 방해되지 않을 정도의 카메라 무빙과 총기 모델 회전을 구현하는데에 집중하였습니다. 이미 폴아웃 4에는 additive animation의 블렌딩을 통해 카메라가 회전했을 때 1인칭 모델에 어느정도의 관성이 적용되고 있었습니다. 하지만, 굉장히 절제된 강도로 적용되어 있기도 하고 총기마다 애니메이션 스타일이 통일되어 있지 않아 그렇게 현실적으로 다가오지는 않았기 때문에 저만의 스타일로 이러한 시스템을 구현해보고자 했습니다.<br>
<br>
### 2. 좌우 기울이기

![타르코프 스타일](assets/uneducatedshooter_tarkov.webp "타르코프 스타일") | ![시즈 스타일](assets/uneducatedshooter_r6s.webp "레인보우식스: 시즈 스타일")

Rainbow Six: Siege, Escape From Tarkov 같은 택티컬 슈터 장르가 다른 슈터와 무엇이 가장 다른가 하면 아마 이 leaning and peeking 메카닉을 꼽을 수 있을 것 같습니다. 폴아웃 4에도 이러한 시스템이 1인칭에만 간단하게 구현이 되어있긴 했는데요, 정말 단순하게 1인칭 상태에서 정면에 엄폐물이 있을 때 정조준을 실행하면 플레이어의 이전 좌표를 기록해두고 엄폐물에서 가장 가까운 모서리 방향으로 플레이어를 강제 이동시키는 방식이었습니다. 저는 기존 기능을 완전히 비활성화 시키고, 1인칭과 3인칭 스켈레톤에 제가 컨트롤 할 수 있는 헬퍼 노드들을 런타임에 삽입하여 회전, 이동시키는 방식으로 좌우 기울이기를 구현하였습니다. 그리고 Escape From Tarkov같이 카메라와 총기 모델이 동시에 회전하는 방식의 경우 멀미를 느끼는 일부 유저들을 배려하여 Rainbow Six: Siege처럼 카메라의 각도는 그대로 유지되면서 총기 모델만 회전하는 기울이기 방식도 사용할 수 있도록 만들었습니다.<br>
<br>
### 3. 플레이어의 자세에 따른 콜리전 보정

베데스다 타이틀에서는 플레이어가 앉더라도 장애물 아래로 지나갈 수 없다는 문제가 있습니다. 게임 디자인적 선택인지는 알 수 없으나, 엔진 코드 상 이러한 부분에 대해 전혀 처리를 해주지 않고 있다는 것을 알 수 있었습니다. 저는 해당 문제를 해결하기 위해 현재 플레이어의 head 노드와 pelvis 노드, 그리고 플레이어 오브젝트의 z 좌표를 이용하여 플레이어의 현재 높이를 추정하고, 땅 속으로 꺼지는 문제를 방지하기 위하여 최솟값을 적용해준 뒤 플레이어 컨트롤러의 Havok 충돌체의 크기를 리사이징 해주었습니다.<br>

### Grappling Hook
{% include elements/video.html id="dncTKnTlbOA" %}
폴아웃 4에 있는 Arrow Projectile (지형지물에 부착되는 프로젝타일) 과 Bendable Spline (로프를 표현하는데에 사용되는 오브젝트)을 사용하여 발사하고 부착되는 갈고리를 구현하고, 실시간으로 액터 가속도를 수정하여 에이펙스 레전드 스타일의 그래플링 훅 시스템을 구현한 모드입니다. 프레임 레이트에 따른 오차가 최소화되도록 틱레이트를 지정하여 어떤 상황에서든 비슷한 움직임이 나타나도록 구현하는데에 집중하였으며, 세이브 파일 시리얼라이즈 인터페이스를 이용하여 세이브 파일 간에서도 그래플링 훅 상태가 유지되도록 하였습니다.
<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/GrapplingHook" text="프로젝트 GitHub" %}
</p>
### Simple Impact
{% include elements/video.html id="_s7pyNSw45U" %}
폴아웃 4의 건파이트 타격감을 증가시키기 위하여 발사 시 카메라 쉐이크, 블러 및 이미지스페이스 오버레이를 추가하고 피격 부위에 따른 히트마크 사운드를 추가하는 모드입니다. 유저가 별다른 설정을 하지 않아도 적절한 강도값이 사용되도록 무기의 데미지, 발사 속도 등을 고려해 점수를 매기는 휴리스틱 함수를 구현하였습니다.
<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/SimpleImpact" text="프로젝트 GitHub" %}
</p>
### Auto Beam
{% include elements/video.html id="WN_E_tuR1CA" %}
폴아웃 4의 무기 부착물 중 장식에 불과한 레이저를 Havok 레이캐스트와 수학의 힘으로 플레이어가 조준하는 곳에 정확히 위치하도록 보정해주는 모드입니다. 실제 총구 방향과 플레이어의 조준 방향도 일치하지 않는 경우가 대부분이었기 때문에 현재 플레이어의 상태, 총구와 조준점의 각도 차이 등 여러 조건을 고려하여 보정 여부를 결정하였고, 총구 움직임을 어느 정도 따라가도록 보정값들을 일정 크기로 샘플링하여 낸 평균값을 이용하였습니다.
<p class="text-center">
{% include elements/button.html link="https://github.com/jarari/AutoBeam" text="프로젝트 GitHub" %}
</p>